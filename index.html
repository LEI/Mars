<!doctype html>
<html>
	<head>

		<meta charset="utf-8">
		<title>Mars</title>

		<link rel="stylesheet" href="style.css">

		<script src="js/jquery.js"></script>
		<script src="js/Base64.js"></script>
		<script src="js/Viewer.js"></script>
		<script src="js/Ground.js"></script>
		<script src="js/DiamondSquare.js"></script>
		<script src="js/Map.js"></script>
		<script src="js/Rover.js"></script>
		<script src="js/Map.js"></script>
		<script src="js/client.js"></script>

	</head>
	<body>

		<header>
			<h1><a href="http://github.com/LEI/Mars" target="_blank">Mars</a></h1>

			<form id="map_settings" method="post">
				<input type="text" id="map_size" placeholder="Taille" class="col"/>
				<input type="text" id="map_square" placeholder="RÃ©solution" class="col"/>
				<input type="text" id="map_softness" placeholder="Relief" class="col"/>
				<input type="submit" value="Render" class="col"/>
			</form>

			<form id="map_reset" method="post">
				<input type="submit" value="Reset" class="col"/>
			</form>

			<input id="map_ds" type="button" value="DiamondSquare" class="col"/>

			<h2>Rover</h2>
			<form id="rover_settings" method="post">
				<input type="text" id="rover_start_x" placeholder="Xa" class="col2"/>
				<input type="text" id="rover_start_y" placeholder="Ya" class="col2"/>
				<br/>
				<input type="text" id="rover_end_x" placeholder="Xb" class="col2"/>
				<input type="text" id="rover_end_y" placeholder="Yb" class="col2"/>
				<input type="submit" value="Go" class="col"/>
			</form>
			<input id="map_test" type="button" value="Test" class="col"/>
		</header>

		<div>
			<form id="download" action="map.json" method="post">
				<input type="submit" value="Download" />
			</form>
			<form id="upload">
				<input type="file"/>
			</form>
		</div>

		<div id="log"></div>

		<div id="canvas"></div>


		<!--
		<canvas id="c" width="17" height="17"></canvas>
		<canvas id="c2" width="640" height="480"></canvas>
		<button id="go">go</button>
		<script>
		  (function() {
		    "use strict";
		    function generateTerrain() {
		      var ctx = document.getElementById("c").getContext("2d");
		      ctx.clearRect(0,0,33,33);
		      var w = 17,
		          h = 17,
		          t = 0;
		      function sp(x,y,n) {
		        var i = ~~n;
		        ctx.fillStyle = "rgb("+[i,i,i].join(",")+")";
		        ctx.fillRect(x,y,1,1);
		      }
		      function gp(id,x,y) {
		        return getPixel(id,x,y)[0];
		      }
		      function nv(b,a) {
		        return b + a*(Math.random()-.5);
		      }
		      function iT(x1, y1, x2, y2, a) {
		        if (x2-x1 < 2 || y2-y1 < 2) {
		          return;
		        }
		        var mx = ~~((x1+x2)/2),
		            my = ~~((y1+y2)/2),
		            id = ctx.getImageData(0,0,w,h),
		            c1 = gp(id,x1,y1),
		            c2 = gp(id,x2,y1),
		            c3 = gp(id,x1,y2),
		            c4 = gp(id,x2,y2);
		        if (!gp(id,mx,my)) sp(mx,my,nv((c1+c2+c3+c4)/4,a));
		        if (!gp(id,mx,y1)) sp(mx,y1,nv((c1+c2)/2,a*.5));
		        if (!gp(id,mx,y2)) sp(mx,y2,nv((c3+c4)/2,a*.5));
		        if (!gp(id,x1,my)) sp(x1,my,nv((c1+c3)/2,a*.5));
		        if (!gp(id,x2,my)) sp(x2,my,nv((c2+c4)/2,a*.5));
		        function next() {
		          iT(x1,y1,mx,my,a*.5);
		          iT(mx,y1,x2,my,a*.5);
		          iT(x1,my,mx,y2,a*.5);
		          iT(mx,my,x2,y2,a*.5);
		        }
		        next();
		      }
		      sp(0,0,128+64*Math.random()-32);
		      sp(0,h-1,128+64*Math.random()-32);
		      sp(w-1,0,128+64*Math.random()-32);
		      sp(w-1,h-1,128+64*Math.random()-32);
		      iT(0,0,w-1,h-1,128);
		      heightMap = document.getElementById("c").getContext("2d").getImageData(0,0,17,17);
		    }

		    function getPixel(iD, px, py) {
		      var o = py * (iD.width*4) + px*4,
		          d = iD.data;
		      return [d[o], d[o+1], d[o+2], d[o+3]];
		    }

		    var heightMap;
		    document.getElementById("go").addEventListener("click",function() {
		      generateTerrain();
		    },false);

		    function renderTerrain() {
		      var a = ((new Date()).getTime() - st) / 1000;
		      var ctx = document.getElementById("c2").getContext("2d"),
		          x,y,
		          n=0;
		      ctx.clearRect(0,0,640,480);
		      function gh(x,y) {
		        return getPixel(heightMap,x,y)[0];
		      }
		      function sx(x,y) {
		        return ((x-8) * Math.cos(a) + (y-8) * Math.sin(a))*32 + 320;
		      }
		      function sy(x,y,h) {
		        return ((x-8) * Math.sin(a) - (y-8) * Math.cos(a) - h/20)*16+380;
		      }
		      for (x = 0; x < 16; x++) {
		        for (y = 0; y < 16; y++) {
		          var h1 = gh(x,y),
		              h2 = gh(x+1,y),
		              h3 = gh(x,y+1),
		              h4 = gh(x+1,y+1);
		          ctx.beginPath();
		          ctx.moveTo(sx(x,y),sy(x,y,h1));
		          ctx.lineTo(sx(x+1,y),sy(x+1,y,h2));
		          ctx.lineTo(sx(x,y+1),sy(x,y+1,h3));
		          n = (h2-(h1+h3)/2)/2+40;
		          ctx.fillStyle = "hsl(90,95%,"+n+"%)";
		          ctx.fill();
		          ctx.beginPath();
		          ctx.moveTo(sx(x,y+1),sy(x,y+1,h3));
		          ctx.lineTo(sx(x+1,y+1),sy(x+1,y+1,h4));
		          ctx.lineTo(sx(x+1,y),sy(x+1,y,h2));
		          n = ((h4+h2)/2-h3)/2 + 40;
		          ctx.fillStyle = "hsl(90,95%,"+n+"%)";
		          ctx.fill();
		        }
		      }
		      //setTimeout(renderTerrain,30);
		    }

		    var ang = 0,
		        st = (new Date()).getTime();
		    generateTerrain();
		    renderTerrain();
		    //setTimeout(renderTerrain,30);
		  })();
		</script>
		-->

	</body>
</html>